@if (TotalPages > 1)
{
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                <button class="page-link" 
                        @onclick="@(() => ChangePage(CurrentPage - 1))"
                        disabled="@(CurrentPage == 1)"
                        aria-label="Previous page">
                    <span aria-hidden="true">&laquo;</span>
                </button>
            </li>

            @foreach (var pageNum in GetPageNumbers())
            {
                <li class="page-item @(pageNum == CurrentPage ? "active" : "")">
                    <button class="page-link" 
                            @onclick="@(() => ChangePage(pageNum))"
                            aria-label="@($"Go to page {pageNum}")"
                            aria-current="@(pageNum == CurrentPage ? "page" : null)">
                        @pageNum
                    </button>
                </li>
            }

            <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                <button class="page-link" 
                        @onclick="@(() => ChangePage(CurrentPage + 1))"
                        disabled="@(CurrentPage == TotalPages)"
                        aria-label="Next page">
                    <span aria-hidden="true">&raquo;</span>
                </button>
            </li>
        </ul>
    </nav>
}

@code {
    /// <summary>
    /// Total number of pages available
    /// </summary>
    [Parameter]
    public int TotalPages { get; set; }

    /// <summary>
    /// Current active page number
    /// </summary>
    [Parameter]
    public int CurrentPage { get; set; }

    /// <summary>
    /// Event callback when page is changed
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageChange { get; set; }

    private async Task ChangePage(int page)
    {
        if (page < 1 || page > TotalPages || page == CurrentPage)
            return;

        await OnPageChange.InvokeAsync(page);
    }

    private IEnumerable<int> GetPageNumbers()
    {
        const int maxVisible = 5;
        var halfVisible = maxVisible / 2;

        int start, end;

        if (TotalPages <= maxVisible)
        {
            start = 1;
            end = TotalPages;
        }
        else if (CurrentPage <= halfVisible + 1)
        {
            start = 1;
            end = maxVisible;
        }
        else if (CurrentPage >= TotalPages - halfVisible)
        {
            start = TotalPages - maxVisible + 1;
            end = TotalPages;
        }
        else
        {
            start = CurrentPage - halfVisible;
            end = CurrentPage + halfVisible;
        }

        return Enumerable.Range(start, end - start + 1);
    }
}
